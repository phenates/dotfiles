#!/bin/bash

{{ if eq .OS_id "linux-debian" "linux-raspbian" "linux-ubuntu" -}}
#^^^ chezmoi script running template condition, must be the first line after the shebang ^^^

#==============================================================================
#description  :chezmoi bash script (with template), install zsh and oh-my-zsh.
#author		    :phenates
#date         :2025-10-14
#version      :0.3
#==============================================================================

{{ $sudo := "sudo " -}}
{{ if eq .chezmoi.username "root" -}}
{{   $sudo = "" -}}
{{ end -}}

set -e # -e: exit on error

## Variables:
SCRIPT_NAME=$(basename "$0")
ZSH_PACKAGES=(
  zsh
)

## Log (enhanced with colors and symbols):
header() {
  echo -e "\n\033[1;35m⮞ $*\033[0m"
  echo -e "\033[1;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
}

info() { echo -e "\033[1;36m  ℹ️  $*\033[0m"; }

success() { echo -e "\033[1;32m  ✅  $*\033[0m"; }

warning() { echo -e "\033[1;33m  ⚠️  WARNING: $*\033[0m"; }

error() { echo -e "\033[1;31m  ❌  ERROR: $*\033[0m" >&2; }

step() { echo -e "\n\033[1;34m  ➜  $*\033[0m"; }

ask_yN() {
  local question="$1"
  local response
  
  echo -e -n "\033[1;33m  ?  $question (y/N): \033[0m"
  read -r response
  
  case "$response" in
    [yY][eE][sS]|[yY])
      return 0
      ;;
    *)
      return 1
      ;;
  esac
}

## Main
header "chezmoi: zsh, Oh-my-zsh, Powerlevel10k theme installation"
echo ""
info "zsh installed by Linux packages install script."
info "oh-my-zsh framework, plugins, theme, and Nerd font, are traited by .chezmoiexternal files."
echo ""


# # Ask user for installation
# if ! ask_yN "Do you want to proceed ?"; then
#   info "Installation cancelled by user"
#   echo ""
#   exit 0
# fi

# # Zsh Install packages if not already installed
# for package in "${ZSH_PACKAGES[@]}"; do
#   step "Checking and installing $package package..."
#   if dpkg -l | grep -q "^ii  $package "; then
#     info "$package already installed"
#     INSTALLED+=("$package")
#   else
#     info "Installing $package..."
#     TO_INSTALL+=("$package")
#     if {{ $sudo }} apt install -qq -y "$package" 2>/dev/null; then
#       success "$package installed"
#     else
#       error "Failed to install $package"
#       exit 1
#     fi
#   fi
# done

# # Oh-my-zsh install
# step "Checking and installing oh-my-zsh framework ..."
# if [[ ! -d "$HOME/.oh-my-zsh" ]]; then
#   sh -c "$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended >/dev/null
#   success "oh-my-zsh installed"
# else
#   info "oh-my-zsh already installed"
# fi

# # Powerlevel10k install
# step "Checking and installing Powerlevel10k theme ..."
# if [[ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k" ]]; then
#   git clone --depth=1 https://github.com/romkatv/powerlevel10k.git "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k" >/dev/null
#   success "Powerlevel10k theme installed"
# else
#   info "Powerlevel10k theme already installed"
# fi

# # Change default shell to zsh
# step "Change default shell to zsh..."
# chsh -s $(which zsh)
# if [ $? -eq 0 ]; then
#   success "Default shell changed to zsh"
#   info "You may need to log out and log back in for the change to take effect."
# else
#   error "Failed to change default shell to zsh"
# fi

# echo ""
# success "zsh installation completed! 🎉"
# echo ""

{{ end -}}