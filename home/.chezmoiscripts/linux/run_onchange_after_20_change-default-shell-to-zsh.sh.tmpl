#!/bin/bash

{{ if (and (eq .OS_id "linux-debian" "linux-raspbian" "linux-ubuntu") (.changeShell)) -}}
#^^^ chezmoi script running template condition, must be the first line after the shebang ^^^

#==============================================================================
#description  :chezmoi bash script (with template), running after `chezmoi apply`
#              Change default shell to zsh.
#author		    :phenates
#date         :2025-10-17
#version      :0.1
#==============================================================================

set -e # -e: exit on error

## Variables:


## Log (enhanced with colors and symbols):
header() {
  echo -e "\n\033[1;35m⮞ $*\033[0m"
  echo -e "\033[1;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
}

info() { echo -e "\033[1;36m  ℹ️  $*\033[0m"; }

success() { echo -e "\033[1;32m  ✅  $*\033[0m"; }

warning() { echo -e "\033[1;33m  ⚠️  WARNING: $*\033[0m"; }

error() { echo -e "\033[1;31m  ❌  ERROR: $*\033[0m" >&2; }

step() { echo -e "\n\033[1;34m  ➜  $*\033[0m"; }

## Main
header "chezmoi: Change default shell to zsh"

# Change default shell to zsh
# step "Change default shell to zsh..."
chsh -s $(which zsh)
if [ $? -eq 0 ]; then
  success "Default shell changed to zsh"
  info "Logout and login or run 'exec zsh && source .zshrc', for the change to take effect."
else
  error "Failed to change default shell to zsh"
fi

{{ end -}}