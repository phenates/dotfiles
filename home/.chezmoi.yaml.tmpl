{{/* File use to customize the chezmoi config file when doing a `chezmoi init`. */}}
{{/* Use template or trigger prompts to populate values. */}}


{{- /* Default values */ -}}
{{- $private  := false -}} {{/* true if this machine should have private secrets */}}
{{- $environmentTags := list -}}
{{- $secretsTags := list -}}
{{- $installZSH := true -}}
{{- $changeShell := true -}}
{{- $ephemeral := false -}}{{/* true if this machine is ephemeral, e.g. a cloud or VM instance */}}
{{- $headless := false -}}{{/* true if this machine does not have a screen and keyboard */}}
{{- $interactive := stdinIsATTY -}}{{/* chezmoiinit functions who returns true if chezmoi's standard input is a TTY */}}


{{- /* Prompts */ -}}
{{- writeToStdout (printf "\n⮞  chezmoi -> host configuration\n") -}}
{{- writeToStdout (printf "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n") -}}

{{- $private_choices := list "Yes" "no" -}}
{{- $private  := promptChoice "  ?  Enable Private mode on this machine (install bitwarden_cli and populate secrets) ?" $private_choices -}}
{{- writeToStdout (printf "    ➜ '%s' \n\n" $private ) -}}
{{- if eq $private "Yes" -}}
{{-   $private = true -}}
{{- else -}}
{{-   $private = false -}}
{{- end -}}

{{- $tag_choices := list "core" "core+" "dev" "sysAdmin" "devOps" "personal" "work" -}}
{{- $environmentTags = promptMultichoice "  ?  Select environments tags for this machine (e.g., core, dev,... )" $tag_choices (list "core") -}}
{{- writeToStdout (printf "    ➜ '%s' \n\n" $environmentTags ) -}}

{{- if $private -}}
{{-   $secretsTags_choices := list "id_homelab" "id_github" "id_phenates" -}}
{{-   $secretsTags = promptMultichoice "  ?  Select secrets tags to populate on this machine (e.g., id_github, ... )" $secretsTags_choices -}}
{{-   writeToStdout (printf "    ➜ '%s' \n\n" $secretsTags ) -}}
{{- end -}}


{{- /* OS infos */ -}}
{{- $OS_ID := .chezmoi.os -}}
{{- if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) -}}
{{-   $OS_ID = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{- $is_WSL := false -}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel.osrelease | lower | contains "microsoft") -}}
{{-     $is_WSL = true -}}
{{-   end -}}
{{- end -}}


{{- /* Hook commands */ -}}
{{ if $private }}
hooks:
  read-source-state:
    pre:
      script: {{ .chezmoi.workingTree }}/home/.chezmoihooks/install-password-manager.sh
{{ end }}


{{- /* Data */ -}}
data:
  name: "phenates"
  email: "phen4tes@gmail.com"
  OS_id: {{ $OS_ID | quote }}
  is_WSL: {{ $is_WSL }}
  signingKey: ""
  private: {{ $private }}
  installZSH: {{ $installZSH }}
  changeShell: {{ $changeShell }}
  environmentTags: {{ $environmentTags | toToml }}
  secretsTags: {{ $secretsTags | toToml }}

edit:
  command: "nano"

bitwarden:
  unlock: "auto"

git:
  autoCommit: true
  autoPush: true

