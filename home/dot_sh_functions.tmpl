# Shell functions sourced by `~/.bashrc` and `~/.zshrc`.

# Sysadmin
# -----------------------------------------------------------------------------

# upup: Keeps all packages up to date.
function upup() {
    if ! [[ "$OSTYPE" =~ ^darwin ]]; then
        if [[ "$EUID" -ne 0 ]]; then
            # Detect package manager and update accordingly
            local pkg_manager=""
            if command -v apt &> /dev/null; then
                pkg_manager="apt"
            elif command -v apt-get &> /dev/null; then
                pkg_manager="apt-get"
            elif command -v dnf &> /dev/null; then
                pkg_manager="dnf"
            elif command -v pacman &> /dev/null; then
                pkg_manager="pacman"
            fi

            case "$pkg_manager" in
                apt)
                    echo '\n-> Updating packages with apt...'
                    sudo apt update          # update list of available packages
                    echo '\n-> Full-upgrade packages with apt...'
                    sudo apt full-upgrade    # upgrade the system by removing/installing/upgrading packages
                    echo '\n-> Autoremove packages with apt...'
                    sudo apt autoremove      # remove unnecessary/unused packages
                    echo '\n-> Clean packages with apt...'
                    sudo apt clean
                    echo '\n-> Autoclean packages with apt...'
                    sudo apt autoclean
                    ;;
                apt-get)
                    echo '\n-> Updating packages with apt-get...'
                    sudo apt-get update
                    echo '\n-> Upgrading packages with apt-get...'
                    sudo apt-get upgrade
                    echo '\n-> Dist-upgrading packages with apt-get...'
                    sudo apt-get dist-upgrade
                    ;;
                dnf)
                    echo '\n-> Updating packages with dnf...'
                    sudo dnf check-update    # check for available package updates
                    echo '\n-> Upgrading packages with dnf...'
                    sudo dnf upgrade         # upgrade all packages to the latest version
                    echo '\n-> Autoremove packages with dnf...'
                    sudo dnf autoremove      # remove unnecessary/unused packages
                    echo '\n-> Clean packages with dnf...'
                    sudo dnf clean all       # clean all cached data
                    ;;
                pacman)
                    echo '\n-> Updating packages with pacman...'
                    sudo pacman -Syu         # synchronize package databases and upgrade all packages
                    echo '\n-> Autoremove packages with pacman...'
                    sudo pacman -Rns $(pacman -Qdtq) 2> /dev/null || true  # remove orphaned packages
                    echo '\n-> Clean cache with pacman...'
                    sudo pacman -Sc --noconfirm  # clean package cache
                    ;;
                *)
                    echo '\n-> No supported package manager found (apt, dnf, pacman)'
                    return 1
                    ;;
            esac
        fi

    fi
}